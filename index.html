<html>
<head>
<title>Guess Who</title>
<link rel="stylesheet" type="text/css" href="style.css">
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
<script src="https://rawgit.com/jasondavies/d3-cloud/master/build/d3.layout.cloud.js"></script>

<body>
<h1>Guess Who?</h1>
<div id="init">
	<h2> Step 1: Pick a character for the AI to try and guess.</h2>
	<div style="text-align:center;">
		<svg id="human_options" width="800" height="600"> </svg>
		<div id="step2" style="visibility: hidden;">
			<h2> Step 2: Start the Game! </h2>
			<div style="text-align:center;">
				<button class="button" style="vertical-align:middle" onclick="start()"><span>Start </span></button>
			</div>
		</div>
	</div>
</div>

<div id="game" style="visibility: hidden; text-align:center;">
	<svg id="images" width="800" height="600"> </svg>
	<svg id="output" width="800" height="600"> 
	<foreignObject x="-350" y="120", height="100", width="1500">
                <input type="text" id="input1"> </input> </br>
                <button id="ask_ai_button" class="btn" style="vertical-align:middle" onclick="ask_ai();"><span> Ask AI </span></button>
    </foreignObject>
    <foreignObject x="-350" y="260", height="100", width="1500" style="visibility: hidden;">
                <input type="text" id="input2"> </input>
                </br>
                <button id="button2" class="btn" style="vertical-align:middle; visibility: hidden;" onclick="click_button2();"><span> Done With Turn </span></button>
    </foreignObject>
	</svg>
	<div style="text-align:center;">
	<button class="button" style="vertical-align:middle;" onclick="location.reload();"><span>Reset </span></button>
	</div>
	<h2> Sample Questions: </h2>
	<h3 >Is your character male?</h3>
	<h3>Is your character smiling?</h3>
	<h3>Does your character have dark hair?</h3>
</div>
</body>

<script>
var human_choice;
var human_question;
var ai_choice;

var dir = "pics1";

var svg = d3.select("#human_options");

var width = +svg.attr("width"); var height = +svg.attr("height");

var padding_top = 50;
var padding_lr = 20;
var padding = 4;
var img_dim = (width - 2*padding_lr-5*padding)/6;
var img_number = 0;
for (var row = 0; row < 4; row++){
    for (var col = 0; col < 6; col++){
        svg.append("image")
            .attr("id","human_img_" + img_number)
            .attr("x", padding_lr + (col)*padding + col*img_dim)
            .attr("y", padding_top+ (row)*padding + (row)*img_dim)
            .attr("height", img_dim)
            .attr("width", img_dim)
            .attr("href", dir+"/pic" + img_number + ".jpg")
            .attr("xlink:href", dir+"/pic" + img_number + ".jpg")
            .on("click", function(){ chooseHumanImg(this.id);});
        img_number++;
    }
}

function chooseHumanImg(img_id){
	var numberPattern = /\d+/g;
	svg.selectAll("*").remove();
	var pic_number = Number(img_id.match(numberPattern)[0]);
	human_choice = pic_number;
	document.getElementById('human_options').setAttribute("height", "300px");
	svg.append("image")
		.attr("x", width/2-270/2)
		.attr("y", 0)
		.attr("height", 270)
		.attr("width", 270)
		.attr("href", dir+"/pic" + pic_number + ".jpg")
        .attr("xlink:href", dir+"/pic" + pic_number + ".jpg");
    document.getElementById("step2").style.visibility="visible";
}

function start(){
	human_question = "";
	var elem = document.getElementById("init");
	elem.parentNode.removeChild(elem);
	ai_choice = Math.floor(Math.random() * 24);
	document.getElementById("game").style.visibility="visible";
	human_turn();
}

// GAME PLAY CODE BELOW

var images_svg = d3.select("#images");
var output_svg = d3.select("#output");
var removed_ai = new Array(24+1).join('0').split('').map(parseFloat);
var removed_human = new Array(24+1).join('0').split('').map(parseFloat);
var is_human_turn = true;
var turn = 0;
var yes = ["yes", "yup", "yeah", "yes!", "yeah!", "yup!", "yea", "yea!", "affirmative"];
var no = ["no", "nope", "nah", "no!", "nope!", "nah!", "negative"];
var idk = ["I don't know..", "not sure", "I don't understand your question :(", "No comprendo", "lol idk sorry", "Alas I was not programmed to understand your question."];


function human_turn(){
	document.body.style.backgroundColor = "#e3e7ea";
	turn++;
	is_human_turn = true;
	images_svg.selectAll("*").remove();
	output_svg.selectAll("text").remove();
	display_images();
	set_up_human();
}

function ai_turn(){
	document.body.style.backgroundColor = "#ffe5e5";
	turn++;
	human_question = "";
	is_human_turn = false;
	images_svg.selectAll("*").remove();
	output_svg.selectAll("text").remove();
	display_images();
	set_up_ai();

}

function display_images(){
	var svg = images_svg;
	var width = +svg.attr("width"); var height = +svg.attr("height");
	var padding_top = 50;
	var padding_lr = 20;
	var padding = 4;
	var img_dim = (width - 2*padding_lr-5*padding)/6;
	var img_number = 0;
	for (var row = 0; row < 4; row++){
    	for (var col = 0; col < 6; col++){
        	svg.append("image")
            .attr("id","human_img_" + img_number)
            .attr("x", padding_lr + (col)*padding + col*img_dim)
            .attr("y", padding_top+ (row)*padding + (row)*img_dim)
            .attr("height", img_dim)
            .attr("width", img_dim)
            .attr("href", dir+"/pic" + img_number + ".jpg")
            .attr("xlink:href", dir+"/pic" + img_number + ".jpg")
            .on("click", function(){console.log("clicked image "+this.id);});
        img_number++;
    	}
	}

}

function set_up_human(){
	var svg = output_svg;
	var width = +svg.attr("width"); var height = +svg.attr("height");
	svg.append("text").text("Human Turn").attr("class", "output_title").attr("x", width/2).attr("y", 40).style("fill","#110D8C");
	svg.append("text").text('Question for AI (must have "yes" or "no" answer):').attr("class", "output_text").attr("x", 30).attr("y", 100).style("fill","#110D8C");
	svg.append("text").text('Human Choice').attr("class", "output_text").attr("x", 500).attr("y", height-175).style("font-size", "20px").style("fill","#110D8C");
    svg.append("text").text('AI Choice').attr("class", "output_text").attr("x", 210).attr("y", height-175).style("font-size", "20px").style("fill","#110D8C");
	if (turn==1){
		svg.append("image").attr("x", 505).attr("y", height-165).attr("height", img_dim).attr("width", img_dim).attr("href", dir+"/pic" + human_choice + ".jpg").attr("xlink:href", dir+"/pic" + human_choice + ".jpg");
		svg.append("image").attr("x", 195).attr("y", height-165).attr("height", img_dim).attr("width", img_dim).attr("href", dir+"/pic" + ai_choice + ".jpg").attr("xlink:href", dir+"/pic" + ai_choice + ".jpg");
	}
	document.getElementById('input1').value=human_question;
	document.getElementById('input2').value=""; 
	document.getElementById("button2").style.visibility="hidden";
	document.getElementById("input2").style.visibility="hidden";
	document.getElementById("ask_ai_button").style.visibility="visible";
}

function ask_ai(){
	var svg = output_svg;
	human_question = document.getElementById('input1').value;
	if (human_question.length == 0){
		window.alert("Please type in a question.");
		return;
	}
	document.getElementById("ask_ai_button").style.visibility="hidden";
	svg.append("text").text('Answer from AI:').attr("class", "output_text").attr("x", 30).attr("y", 240).style("fill","#110D8C");
	document.getElementById("input2").style.visibility="visible";
	document.getElementById('input2').value=get_ai_answer(); 
	document.getElementById("button2").style.visibility="visible";
	document.getElementById("button2").innerText = "Done With Turn";
}

function set_up_ai(){
	var svg = output_svg;
	document.getElementById('input1').value=get_ai_question();
	svg.append("text").text("AI Turn").attr("class", "output_title").attr("x", width/2).attr("y", 40).style("fill","#660000");
	svg.append("text").text('Question for human from AI:').attr("class", "output_text").attr("x", 30).attr("y", 100).style("fill","#660000");
	svg.append("text").text('Answer from human:').attr("class", "output_text").attr("x", 30).attr("y", 240).style("fill","#660000");
	svg.append("text").text('Human Choice').attr("class", "output_text").attr("x", 500).attr("y", height-175).style("font-size", "20px").style("fill","#660000");
    svg.append("text").text('AI Choice').attr("class", "output_text").attr("x", 210).attr("y", height-175).style("font-size", "20px").style("fill","#660000");
    document.getElementById("button2").style.visibility="visible";
    document.getElementById("button2").innerText = "Done Answering";
    document.getElementById('input2').value=""; 
}

function get_ai_answer(){
	return idk[ Math.floor(Math.random() * idk.length)];
}

function get_ai_question(){
	return "what are questions";
}

function handle_human_answer(){
	console.log("ai should do something here");
}

function click_button2(){
	if (is_human_turn){
		ai_turn();
	}
	else if (document.getElementById("button2").innerText === "Done Answering"){
		document.getElementById("button2").innerText = "Done With AI Turn";
	}
	else{
		human_turn();
	}
}
</script>

</html>